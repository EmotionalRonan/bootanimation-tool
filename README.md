# 开关机动画制作工具

一个基于 PyQt5 的图形化工具，用于快速制作符合 Android 规范的启动动画 (`bootanimation.zip`)。

## 功能特性

- 🎞️ **多段落动画**: 支持动态添加和移除动画段落 (Part 0, Part 1, Part 2, ...)。
- 🖼️ **图片导入**: 每个段落支持批量导入 PNG、JPG、JPEG、BMP、GIF 格式的图片。
- ⚙️ **参数精细设置**:
    - **全局帧率 (FPS)**: 控制整体动画播放速度。
    - **每段独立参数**: 每个动画段落均可独立设置**循环次数**和**暂停时间** (毫秒)。
- ✨ **智能默认值**:
    - **循环逻辑**: 默认最后一段动画无限循环 (0次)，其他所有段落循环1次。此默认值会随着段落的添加和移除动态调整。
    - **输出路径**: 首次为 Part 0 添加图片且输出路径为空时，会自动将输出路径设置为所选图片的上级目录，并命名为 `bootanimation.zip`。
- 👀 **实时预览**: 在图片列表中选择图片即可预览效果。
- 📦 **一键生成**: 自动生成包含所有段落图片和 `desc.txt` 描述文件的 `bootanimation.zip`。
- 🔄 **多线程处理**: 后台处理，避免界面卡顿。
- 📊 **进度显示**: 实时显示动画创建进度。

## 安装依赖

```bash
pip install -r requirements.txt
```

或者手动安装：

```bash
pip install PyQt5 Pillow
```

## 使用方法

1.  **启动程序**
    ```bash
    python run.py
    ```

2.  **段落管理** (可选)
    - 程序启动时会默认创建一个 "Part 0" 段落。
    - 点击 "添加新段落" 按钮可以创建更多动画段落 (Part 1, Part 2, ...)。
    - 点击 "移除最后段落" 按钮可以移除最后一个添加的段落 (至少会保留一个段落)。

3.  **导入图片到段落**
    - 选中希望操作的段落选项卡 (例如 "Part 0")。
    - 点击该段落内的 "导入图片到 Part X" 按钮。
    - 选择要用于该段落动画的图片文件 (支持多选)。图片会按文件名顺序在该段落内播放。

4.  **设置参数**
    - **全局设置**: 
        - **帧率 (FPS)**: 在 "全局动画设置"区域设置，控制动画的整体播放速度 (范围 1-60)。
    - **段落设置**: 在每个段落的选项卡内进行设置：
        - **循环次数**: 控制该段落动画的播放次数。0 表示无限循环。默认情况下，只有最后一个段落的循环次数为0，其他段落为1。
        - **此段暂停 (ms)**: 控制该段落动画播放完毕后暂停的时间（单位：毫秒）。默认为0。

5.  **选择输出路径**
    - 在 "全局动画设置"区域，点击 "浏览" 按钮选择 `bootanimation.zip` 文件的保存位置和名称。
    - **提示**: 如果此路径为空，并且您首次为 "Part 0" 导入图片，程序会自动将输出路径设置为这些图片所在文件夹的上一级，并命名为 `bootanimation.zip`。

6.  **创建动画**
    - 点击主界面底部的 "创建动画" 按钮。
    - 等待进度条完成，处理完成后会显示成功消息。

## 输出格式

生成的 `bootanimation.zip` 文件包含：

```
bootanimation.zip
├── desc.txt          # 动画描述文件
├── part0/            # 第一个动画段落的图片目录
│   ├── 00000.jpg
│   ├── 00001.jpg
│   └── ...
├── part1/            # 第二个动画段落的图片目录 (如果存在)
│   ├── 00000.jpg
│   └── ...
└── ...               # 更多段落的图片目录 (如果存在)
```

### desc.txt 格式说明

`desc.txt` 文件定义了动画的播放方式。例如：

```
1080 1920 30
p 1 0 part0
p 0 100 part1
c 0 0 part2
```

-   **第一行**: `宽度 高度 帧率`
    -   例如：`1080 1920 30` 表示动画分辨率为 1080x1920，帧率为 30 FPS。
-   **后续行 (每个段落一行)**: `类型 循环次数 暂停时间 目录名 [额外参数]`
    -   **类型 (`p` 或 `c`)**: 
        -   `p`: 普通播放段落。动画会完整播放此段落指定的循环次数后，再根据暂停时间暂停，然后继续下一个段落（如果存在）。
        -   `c`: 完整播放段落（Android Lollipop 5.0 新增）。与 `p` 类似，但设计上通常用于动画的结尾部分，可以确保即使动画被中断（如系统启动完成），此段落的最后一帧也会显示完整。在我们的工具中，所有段落都默认生成为 `p` 类型。
    -   **循环次数**: 该段落重复播放的次数。`0` 表示无限循环。 **只有最后一个 `p` 行可以指定无限循环；如果所有 `p` 行的循环次数都非0，则整个动画只播放一次。**
    -   **暂停时间**: 该段落播放完一次循环后暂停的时间（单位通常是帧数，但在很多实现中也被解释为毫秒，我们的工具中是毫秒，并写入 `desc.txt`）。
    -   **目录名**: 包含该段落图片序列的文件夹名称 (例如 `part0`, `part1`)。
    -   **[额外参数] (可选)**: 某些 `desc.txt` 实现支持额外参数，如背景色等，但本工具暂不直接支持这些高级参数的配置。

**重要**: Android 系统会顺序执行 `desc.txt` 中的每一行。如果某个 `p` 段落的循环次数设为 `0`（无限循环），那么它之后的任何段落都不会被播放。

## UI 主题

- 采用莫兰迪色系设计
- 主背景色: #e9e5e2 (暖灰色)
- 控件背景色: #f5f0eb (柔和米色)
- 按钮颜色: #b8c8d8 (灰蓝色)
- 文字颜色: #5a4a3a (低对比棕色)

## 注意事项

- 建议使用相同尺寸的图片以获得最佳效果。
- 支持的分辨率范围：480x800 至 1440x2560 (但实际取决于设备)。
- 图片数量建议控制在合理范围内，避免文件过大。
- 生成的动画文件大小取决于图片数量和质量。
- 高分辨率图片会显著增加处理时间和文件大小。

## 系统要求

- Python 3.6+
- PyQt5
- Pillow (PIL)
- 支持 Windows、macOS、Linux

## 故障排除

### 常见问题

1.  **导入图片失败**
    -   检查图片格式是否支持。
    -   确保图片文件未损坏或路径正确。

2.  **创建动画失败**
    -   检查输出路径是否有写入权限。
    -   确保磁盘空间充足。

3.  **程序无法启动**
    -   检查 Python 版本。
    -   确认已安装所有依赖 (`pip install -r requirements.txt`)。

## 许可证

MIT License

## 贡献

欢迎提交 Issue 和 Pull Request！
